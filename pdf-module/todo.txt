 Dependencias a instalar
bash
npm install @react-pdf/renderer html2canvas jspdf
npm install -D @types/jspdf
npm install pdf-lib
npm install @react-pdf/renderer



# ğŸ“§ SISTEMA DE GENERACIÃ“N Y ENVÃO DE PDFs

## ğŸ—ï¸ ESTRUCTURA DEL PROYECTO

pdf-module/
â”œâ”€â”€ types/
â”‚   â””â”€â”€ dynamic.ts              # Tipos TypeScript
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ PDFService.ts           # Servicio principal de PDF
â”‚   â””â”€â”€ PDFEmailService.ts      # Servicio de email con Nodemailer
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ DynamicTemplate.ts      # Template universal para PDF
â””â”€â”€ index.ts                    # Exportaciones

app/
â”œâ”€â”€ api/pdf/
â”‚   â”œâ”€â”€ generate/route.ts       # API: Generar PDF
â”‚   â””â”€â”€ send/route.ts           # API: Generar y enviar PDF por email
â””â”€â”€ mail-pdf/
    â””â”€â”€ page.tsx                # Interfaz web para pruebas

## ğŸš€ INSTALACIÃ“N Y CONFIGURACIÃ“N

### 1. Dependencias necesarias
```bash
npm install pdf-lib nodemailer
npm install -D @types/nodemailer
2. Variables de entorno (.env.local)
env
# ConfiguraciÃ³n SMTP (Ejemplo para Gmail)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=tu-email@gmail.com
SMTP_PASS=tu-app-password-de-16-digitos
SMTP_FROM="Tu Sistema <tu-email@gmail.com>"
3. Configurar Gmail (si usas Gmail)
Activar verificaciÃ³n en 2 pasos

Ir a https://myaccount.google.com/apppasswords

Generar "App password" de 16 dÃ­gitos

Usar ese password en SMTP_PASS

ğŸ“– CÃ“MO USAR
ğŸ¯ Desde el Frontend (React/Next.js)
1. Generar PDF solamente
tsx
const generatePDF = async () => {
  const response = await fetch('/api/pdf/generate', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      data: {
        // CUALQUIER estructura de datos
        factura: {
          numero: "FAC-001",
          fecha: new Date().toISOString(),
          cliente: { nombre: "Juan PÃ©rez" },
          items: [
            { producto: "Laptop", precio: 1500, cantidad: 1 }
          ],
          total: 1500
        }
      },
      config: {
        styles: {
          primaryColor: "#2563eb",
          fontFamily: "Helvetica"
        },
        metadata: {
          title: "Mi Factura PDF"
        }
      }
    })
  });

  const result = await response.json();
  if (result.success) {
    // Descargar PDF
    const link = document.createElement('a');
    link.href = `data:application/pdf;base64,${result.pdf}`;
    link.download = 'documento.pdf';
    link.click();
  }
};
2. Generar y enviar PDF por email
tsx
const sendPDFByEmail = async () => {
  const response = await fetch('/api/pdf/send', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      pdfRequest: {
        data: {
          // Tus datos para el PDF
          reporte: {
            titulo: "Reporte Mensual",
            ventas: 15000
          }
        },
        config: {
          // ConfiguraciÃ³n opcional del PDF
          styles: { primaryColor: "#10b981" }
        }
      },
      emailConfig: {
        to: "cliente@email.com",
        subject: "Tu documento adjunto",
        body: "Hola, adjunto el documento solicitado.",
        cc: "copia@empresa.com",
        bcc: "archivo@empresa.com"
      }
    })
  });

  const result = await response.json();
  if (result.success) {
    alert('âœ… PDF enviado correctamente!');
  }
};
ğŸŒ Desde otros servicios/APIs
1. Usando cURL
bash
# Generar PDF
curl -X POST http://localhost:3000/api/pdf/generate \
  -H "Content-Type: application/json" \
  -d '{
    "data": {
      "documento": {
        "titulo": "Mi PDF",
        "contenido": "Este es un ejemplo"
      }
    }
  }'

# Generar y enviar por email
curl -X POST http://localhost:3000/api/pdf/send \
  -H "Content-Type: application/json" \
  -d '{
    "pdfRequest": {
      "data": {
        "factura": {
          "numero": "TEST-001",
          "total": 1000
        }
      }
    },
    "emailConfig": {
      "to": "test@email.com",
      "subject": "Test PDF",
      "body": "Este es un test"
    }
  }'
2. Desde Node.js/Express
javascript
const sendPDFFromBackend = async () => {
  const pdfData = {
    pdfRequest: {
      data: {
        orden: {
          id: "ORD-123",
          productos: [
            { nombre: "Producto A", precio: 100 }
          ]
        }
      }
    },
    emailConfig: {
      to: "cliente@empresa.com",
      subject: "ConfirmaciÃ³n de orden",
      body: "Gracias por tu compra!"
    }
  };

  const response = await fetch('https://tu-app.com/api/pdf/send', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(pdfData)
  });

  return await response.json();
};
ğŸ“Š ESTRUCTURA DE DATOS
PDFGenerationRequest
typescript
{
  data: { ... },  // âœ… CUALQUIER objeto JSON
  config?: {
    template?: 'invoice' | 'receipt' | 'report' | 'custom',
    styles?: {
      primaryColor?: string,    // Ej: "#2563eb"
      secondaryColor?: string,  // Ej: "#64748b"
      fontFamily?: string,      // Ej: "Helvetica"
      fontSize?: number         // Ej: 10
    },
    metadata?: {
      title?: string,           // TÃ­tulo del documento
      author?: string,          // Autor
      subject?: string          // Asunto
    }
  }
}
EmailConfig
typescript
{
  to: string | string[],        // âœ… Obligatorio
  subject: string,              // âœ… Obligatorio  
  body: string,                 // âœ… Obligatorio
  cc?: string | string[],       // âœ… Opcional
  bcc?: string | string[]       // âœ… Opcional
}
ğŸ¨ EJEMPLOS DE ESTRUCTURAS DE DATOS
Factura (Invoice)
json
{
  "factura": {
    "numero": "FAC-2024-001",
    "fecha_emision": "2024-01-15",
    "emisor": {
      "nombre": "Mi Empresa S.A.",
      "direccion": "Calle 123",
      "telefono": "+54 11 1234-5678"
    },
    "cliente": {
      "nombre": "Cliente S.R.L.",
      "email": "cliente@empresa.com"
    },
    "items": [
      {
        "descripcion": "Servicio Web",
        "cantidad": 1,
        "precio_unitario": 5000,
        "total": 5000
      }
    ],
    "subtotal": 5000,
    "iva": 1050,
    "total": 6050,
    "moneda": "ARS"
  }
}
Recibo (Receipt)
json
{
  "recibo": {
    "numero": "REC-2024-001", 
    "fecha": "2024-01-15",
    "cliente": {
      "nombre": "Juan PÃ©rez",
      "documento": "30.123.456"
    },
    "concepto": "Pago de servicios",
    "monto": 25000,
    "metodo_pago": "Transferencia",
    "estado": "Pagado"
  }
}
Reporte (Report)
json
{
  "reporte": {
    "titulo": "Ventas Mensuales",
    "periodo": "Enero 2024", 
    "resumen": {
      "ventas_totales": 154320,
      "cantidad_pedidos": 892,
      "ticket_promedio": 173
    },
    "productos_destacados": [
      {"producto": "Software", "ventas": 45230},
      {"producto": "Cloud", "ventas": 38940}
    ]
  }
}
ğŸ”§ API ENDPOINTS
POST /api/pdf/generate
DescripciÃ³n: Genera un PDF a partir de datos JSON

Body: PDFGenerationRequest

Response:

json
{
  "success": true,
  "pdf": "base64-string...",
  "metadata": {
    "generationTime": 150,
    "fileSize": 2048
  }
}
POST /api/pdf/send
DescripciÃ³n: Genera PDF y lo envÃ­a por email

Body:

json
{
  "pdfRequest": PDFGenerationRequest,
  "emailConfig": EmailConfig
}
Response:

json
{
  "success": true,
  "pdfGenerated": true,
  "emailSent": true,
  "messageId": "message-id",
  "metadata": {
    "generationTime": 150,
    "fileSize": 2048
  }
}
GET /api/pdf/generate
DescripciÃ³n: DocumentaciÃ³n y ejemplos del endpoint

GET /api/pdf/send
DescripciÃ³n: DocumentaciÃ³n y test de conexiÃ³n SMTP

ğŸ› ï¸ TROUBLESHOOTING
âŒ Error de conexiÃ³n SMTP
Verificar variables de entorno

Probar con: GET /api/pdf/send

Para Gmail: usar App Password, no contraseÃ±a normal

âŒ JSON invÃ¡lido
Usar JSON vÃ¡lido en el campo "content"

Probar con los ejemplos predefinidos

Validar en https://jsonlint.com/

âŒ PDF no se genera
Verificar que los datos no estÃ©n vacÃ­os

Revisar la consola del navegador

Probar con datos mÃ¡s simples

âŒ Email no llega
Revisar carpeta de spam

Verificar destinatario correcto

Probar con email personal primero

ğŸš€ CARACTERÃSTICAS
âœ… Ventajas del sistema
Totalmente dinÃ¡mico: Acepta cualquier estructura JSON

100% reutilizable: Mismo cÃ³digo para facturas, recibos, reportes, etc.

FÃ¡cil integraciÃ³n: Simple API REST

Configurable: Colores, fuentes, metadatos

Con Nodemailer: EnvÃ­o de emails integrado

Responsive: Interfaz web incluida

TypeScript: Tipado completo

âœ… Casos de uso
Facturas automÃ¡ticas

Reportes periÃ³dicos

Recibos de pago

Certificados

Contratos

Presupuestos

Cualquier documento personalizado

ğŸ“ SOPORTE
Para probar:
Ir a: http://localhost:3000/mail-pdf

Usar los ejemplos predefinidos

Configurar variables de entorno SMTP

Â¡Listo!

Para integrar:
Usar los endpoints API desde tu frontend/backend

Seguir las estructuras de datos mostradas

Personalizar segÃºn necesidades


http://localhost:3000/api/pdf/test-connection